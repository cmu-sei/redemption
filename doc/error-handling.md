# Error Handling Observations

<legal>
'Redemption' Automated Code Repair Tool
Copyright 2023, 2024 Carnegie Mellon University.
NO WARRANTY. THIS CARNEGIE MELLON UNIVERSITY AND SOFTWARE ENGINEERING
INSTITUTE MATERIAL IS FURNISHED ON AN 'AS-IS' BASIS. CARNEGIE MELLON
UNIVERSITY MAKES NO WARRANTIES OF ANY KIND, EITHER EXPRESSED OR IMPLIED,
AS TO ANY MATTER INCLUDING, BUT NOT LIMITED TO, WARRANTY OF FITNESS FOR
PURPOSE OR MERCHANTABILITY, EXCLUSIVITY, OR RESULTS OBTAINED FROM USE OF
THE MATERIAL. CARNEGIE MELLON UNIVERSITY DOES NOT MAKE ANY WARRANTY OF ANY
KIND WITH RESPECT TO FREEDOM FROM PATENT, TRADEMARK, OR COPYRIGHT
INFRINGEMENT.
Licensed under a MIT (SEI)-style license, please see License.txt or
contact permission@sei.cmu.edu for full terms.
[DISTRIBUTION STATEMENT A] This material has been approved for public
release and unlimited distribution.  Please see Copyright notice for
non-US Government use and distribution.
This Software includes and/or makes use of Third-Party Software each
subject to its own license.
DM23-2165
</legal>

These observations were made while doing REM-9.

## Git

Git has an `error()` function, which takes printf-style args, reports the error and returns.
Git also has a `die()` function, which calls `exit()`. (but can probably be overridden)

## Zeek (v5.1.1)

Zeek has a `sec` enum class that indicates various errors, often used as return values. (`sec::none == 0`).
Zeek also has several enum classes, such as `connection_state` that indicate various non-error states.

Zeek's EXP34-C alerts can be partitioned as follows:

| File                              | Num |
|-----------------------------------|-----|
| auxil/broker/3rdparty/sqlite3.c   | 14  |
| src/3rdparty/patricia.c           | 26  |
| src/3rdparty/sqlite3.c            | 38  |
|-----------------------------------|-----|
| Third-party code (total of above) | 78  |
| Autogenerated code in build/      | 8   |
| Remaining                         | 25  |
|-----------------------------------|-----|
| Total                             | 111 |

## Data

I have analyzed 42 alerts in the non-autogenerated, non-3rdparty code (212-78-8=126 alerts

The file `data/EXP34-C.csv` has all of the null-pointer alerts for dos2unix, git and zeek.  It also has these extra columns:

    Error

The error-handling strategy of the source function containing the code that generated the alert. Most are `???` meaning Unknown.

    Verdict

Indicates if the alert is true or false. However the verdicts's meanings are slightly different.
`False` means not only is this alert a false positive, but our tool should be able to discern this and decide that no repair need be done.
Suspicious = worth fixing, even though the alert might not be true.

    Notes

Any extra notes associated with this error

## Detecting Error Detection

If a function returns an `int` (or any integer type that is not an enum), then look for all return statements. Any return statement with a value distinct from the final return statement (at the end of the function) indicates a good value to return upon error.

A function that returns an enumeration class is harder, unless the enum class provides an obvious error value that we can piggyback off of.  But we will not handle such a case for now.

Likewise, if a function returns a pointer type, then look for all return statements. If it returns NULL anywhere in the function, but a potentially non-null value at the end, then assume that the program can return NULL upon error.

If the above fails, default to `abort()`.

We will always allow the user to provide custom error-handling code, such as `die()`.  But detecting custom error-handling code is (currently) beyond our ability to detect.
